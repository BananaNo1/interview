### 脏读，不可重复读，幻读

#### 脏读

读到了其他事务未提交的数据，未提交意味着这些数据可能会回滚，也就是不存在的数据。

#### 不可重复读

事务A多次读取同一数据，但事务B在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果不一样。

#### 幻读

select某记录是否存在，不存在，准备插入此数据。但在insert时发现此记录已存在，无法插入，发生了幻读。





### MVCC

`Multi-Version Concurrency Control` 多版本并发控制

主要是为了提高数据库并发性能，用更好的方式去处理读-写冲突，做到即使有读写冲突时，也能做到不加锁，非阻塞并发读

#### **依赖于隐藏的两个列**

在**每一行记录的后面增加两个隐藏列，记录创建事务ID(创建版本号)和删除事务ID(删除版本号)**,在每次执行新的事务时，都会更新并且递增唯一的事务ID.

#### **ReadView**

在innodb 中每个事务开启后都会得到一个read_view。副本主要保存了当前数据库系统中正处于活跃（没有commit）的事务的ID号，其实简单的说这个副本中保存的是系统中当前不应该被本事务看到的其他事务id列表。

### 数据库三范式

1. 1NF 强调属性的原子性约束，要求属性具有原子性，不可再分解。

2. 2NF 属性完全依赖于主键，要求所有非主键字段必须完全依赖主键，不要产生部分依赖。
   1. 消除了数据冗余、更新异常、插入异常和删除异常

3. 3NF 消除了非主属性对于候选码的传递函数依赖。要求所有非主键字典必须直接依赖主键，不要产生传递依赖。

4. BCNF 消除主属性对于码的部分与传递函数依赖

### myism，innodb区别

|                      | MyISAM                                                       | InnoDB                                                       |
| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 全文索引             | 支持FULLTEXT类型的全文索引                                   | 不支持FULLTEXT类型的全文索引，但是InnoDB可以使用sphinx插件支持全文索引，并且效果更好 |
| 存储结构             | 每个MyISAM在磁盘上存储成三个文件。第一个文件的名字以表的名字开始，拓展名指出文件类型。.frm文件存储表定义。数据文件的扩展名为.MYD(MYData).索引文件的拓展名为.MYI(MYIndex) | 所有的表都保存在一个数据文件中(也可能是多个文件，或者是独立的表空间文件)，InnoDB表的大小只受限于操作系统文件的大小，一般为2GB |
| 存储空间             | 可被压缩，存储空间较小。支持三种不同的存储格式：静态表(默认，但是注意数据末尾不能有空格，会被去掉)、动态表、压缩表。 | 需要更多的内存和存储，她会在主内存中建立其专用的缓冲池用于高速缓冲数据和索引 |
| 可移植性、备份及恢复 | 数据是以文件的形式存储，所以在跨平台的数据转移中会很方便。在备份和恢复时可单独针对某个表进行操作 | 拷贝数据文件，备份binlog，或者用mysqldumpl                   |
| 事务支持             | 强调的是性能，每次查询具有原子性，其执行速度比InnoDB类型更快，但是不提供事务支持 | 提供事务支持，外键。具有事务，回滚和崩溃修复能力的事务安全型表。 |
| 表锁差异             | 只支持表锁，                                                 | 支持行级锁                                                   |
| 表主键               | 允许没有任何索引和主键的表存在，索引都是保存行的地址         | 如果没有设定主键或者非空唯一索引，会自动生成一个6字节的主键(用户不可见),数据是索引的一部分，附加索引保存的是主索引的值 |
| 表的具体行数         | 保存表的总行数                                               | 没有保存表的总行数                                           |
| 外键                 | 不支持                                                       | 支持                                                         |

### Mysql隔离级别

1. 读未提交
2. 读已提交
3. 可重复读    MVCC
4. 序列化

### 数据库的锁类型

#### 锁粒度细分

1. 表锁
2. 页锁    在页的粒度上进行锁定，锁定的数据资源比行锁要多，因为一个页中可以有多个行记录。
3. 行锁

#### 数据库管理角度

1. 共享锁 /读锁/S锁
2. 排他锁/写锁/X锁
3. 意向锁   意向锁都是表锁  为了允许事务在行级上的锁和表级上的锁同时存在。

如果给某一行数据加上了排它锁，数据库会自动给更大一级的空间，比如数据页或数据表加上意向锁，告诉其他人这个数据页或数据表已经有人上过排它锁了，这样**当其他人想要获取数据表排它锁的时候，只需要了解是否有人已经获取了这个数据表的意向排他锁即可。**

### 删除表的关键字

1. delete 删除表内数据
2. drop  删除整张表  
3. truncate 只删除表内数据，会保留表结构
